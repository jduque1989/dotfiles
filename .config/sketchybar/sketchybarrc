#!/bin/bash

source "$HOME/.config/sketchybar/colors.sh"

PLUGIN_DIR="$HOME/.config/sketchybar/plugins"

##### Bar Appearance #####
sketchybar --bar height=32 \
                 blur_radius=30 \
                 position=top \
                 sticky=off \
                 padding_left=10 \
                 padding_right=10 \
                 color=$BAR_COLOR

##### Default Item Settings #####
sketchybar --default icon.font="SF Pro:Semibold:15.0" \
                     icon.color=$ICON_COLOR \
                     label.font="SF Pro:Semibold:13.0" \
                     label.color=$LABEL_COLOR \
                     padding_left=5 \
                     padding_right=5 \
                     label.padding_left=4 \
                     label.padding_right=4 \
                     icon.padding_left=4 \
                     icon.padding_right=4

##### Modern Aerospace Workspace Indicators #####
# Enhanced workspaces with better visibility and functionality

WORKSPACES=(T B M W)
WORKSPACE_NAMES=("Terminal" "Browser" "Music" "Work")

for i in "${!WORKSPACES[@]}"; do
    workspace="${WORKSPACES[$i]}"
    workspace_name="${WORKSPACE_NAMES[$i]}"
    
    sketchybar --add item space_$workspace left \
               --set space_$workspace \
                     icon="$workspace" \
                     icon.font="SF Pro:Semibold:14.0" \
                     icon.padding_left=8 \
                     icon.padding_right=3 \
                     label="" \
                     label.font="SF Pro:Regular:10.0" \
                     label.padding_left=0 \
                     label.padding_right=8 \
                     background.padding_left=2 \
                     background.padding_right=2 \
                     background.color=$WORKSPACE_EMPTY_BG \
                     background.corner_radius=6 \
                     background.height=24 \
                     background.drawing=on \
                     script="$PLUGIN_DIR/aerospace.sh" \
                     click_script="aerospace workspace $workspace" \
               --subscribe space_$workspace aerospace_workspace_change window_focus front_app_switched
done

##### Adding Separator #####
sketchybar --add item space_separator left \
           --set space_separator icon="|" \
                                 icon.color=0x40a9b1d6 \
                                 icon.padding_left=8 \
                                 icon.padding_right=8 \
                                 background.drawing=off

##### Adding Front App #####
sketchybar --add item front_app left \
           --set front_app icon.drawing=off \
                          label.color=$WHITE \
                          script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

##### Adding Center Items (Media Player - Spotify & YouTube) #####
sketchybar --add item media_player center \
           --set media_player update_freq=3 \
                             background.drawing=on \
                             background.color=0x15000000 \
                             background.corner_radius=6 \
                             background.height=20 \
                             background.padding_left=4 \
                             background.padding_right=4 \
                             icon.padding_left=8 \
                             icon.padding_right=4 \
                             label.padding_left=0 \
                             label.padding_right=8 \
                             label.font="SF Pro:Medium:11.0" \
                             icon.font="SF Pro:Medium:12.0" \
                             script="$PLUGIN_DIR/media_player.sh" \
                             click_script="$PLUGIN_DIR/media_click.sh" \
                             drawing=off \
           --add item media_player.previous popup.media_player \
           --set media_player.previous background.drawing=on \
                                      background.color=0x80000000 \
                                      background.corner_radius=4 \
                                      background.height=18 \
                                      background.padding_left=4 \
                                      background.padding_right=4 \
                                      icon.padding_left=6 \
                                      icon.padding_right=4 \
                                      label.padding_left=0 \
                                      label.padding_right=6 \
                                      label.font="SF Pro:Regular:10.0" \
                                      click_script="$PLUGIN_DIR/media_click.sh previous" \
           --add item media_player.playpause popup.media_player \
           --set media_player.playpause background.drawing=on \
                                        background.color=0x80000000 \
                                        background.corner_radius=4 \
                                        background.height=18 \
                                        background.padding_left=4 \
                                        background.padding_right=4 \
                                        icon.padding_left=6 \
                                        icon.padding_right=4 \
                                        label.padding_left=0 \
                                        label.padding_right=6 \
                                        label.font="SF Pro:Regular:10.0" \
                                        click_script="$PLUGIN_DIR/media_click.sh playpause" \
           --add item media_player.next popup.media_player \
           --set media_player.next background.drawing=on \
                                   background.color=0x80000000 \
                                   background.corner_radius=4 \
                                   background.height=18 \
                                   background.padding_left=4 \
                                   background.padding_right=4 \
                                   icon.padding_left=6 \
                                   icon.padding_right=4 \
                                   label.padding_left=0 \
                                   label.padding_right=6 \
                                   label.font="SF Pro:Regular:10.0" \
                                   click_script="$PLUGIN_DIR/media_click.sh next" \
           --add event media_update \
           --subscribe media_player media_update

##### Adding Right Items (Calendar â†’ Battery â†’ Volume â†’ System Monitoring) #####
sketchybar --add item clock right \
           --set clock update_freq=10 \
                       background.drawing=on \
                       background.color=0x20000000 \
                       background.corner_radius=4 \
                       background.height=18 \
                       background.padding_left=2 \
                       background.padding_right=2 \
                       icon=ðŸ“… \
                       icon.color=$WHITE \
                       icon.padding_left=6 \
                       icon.padding_right=2 \
                       label.padding_left=0 \
                       label.padding_right=6 \
                       label.font="SF Pro:Medium:10.0" \
                       script="$PLUGIN_DIR/clock.sh" \
           --add item battery right \
           --set battery update_freq=120 \
                        background.drawing=on \
                        background.color=0x20000000 \
                        background.corner_radius=4 \
                        background.height=18 \
                        background.padding_left=2 \
                        background.padding_right=2 \
                        icon.padding_left=6 \
                        icon.padding_right=2 \
                        label.padding_left=0 \
                        label.padding_right=6 \
                        label.font="SF Pro:Medium:10.0" \
                        script="$PLUGIN_DIR/battery.sh" \
           --subscribe battery system_woke power_source_change \
           --add item volume right \
           --set volume background.drawing=on \
                       background.color=0x20000000 \
                       background.corner_radius=4 \
                       background.height=18 \
                       background.padding_left=2 \
                       background.padding_right=2 \
                       icon.padding_left=6 \
                       icon.padding_right=2 \
                       label.padding_left=0 \
                       label.padding_right=6 \
                       label.font="SF Pro:Medium:10.0" \
                       script="$PLUGIN_DIR/volume.sh" \
           --subscribe volume volume_change

##### Adding System Stats Menu #####
sketchybar --add item system_stats_menu right \
           --set system_stats_menu update_freq=10 \
                                  background.drawing=on \
                                  background.color=0x20000000 \
                                  background.corner_radius=4 \
                                  background.height=18 \
                                  background.padding_left=2 \
                                  background.padding_right=2 \
                                  icon.padding_left=6 \
                                  icon.padding_right=2 \
                                  label.padding_left=0 \
                                  label.padding_right=6 \
                                  label.font="SF Pro:Medium:10.0" \
                                  script="$PLUGIN_DIR/system_stats.sh" \
                                  click_script="$PLUGIN_DIR/system_menu.sh toggle" \
           --add item system_stats_menu.ram popup.system_stats_menu \
           --set system_stats_menu.ram background.drawing=on \
                                       background.color=0x30000000 \
                                       background.corner_radius=4 \
                                       background.height=18 \
                                       background.padding_left=4 \
                                       background.padding_right=4 \
                                       icon.padding_left=6 \
                                       icon.padding_right=4 \
                                       label.padding_left=0 \
                                       label.padding_right=6 \
                                       label.font="SF Pro:Regular:10.0" \
           --add item system_stats_menu.disk popup.system_stats_menu \
           --set system_stats_menu.disk background.drawing=on \
                                        background.color=0x30000000 \
                                        background.corner_radius=4 \
                                        background.height=18 \
                                        background.padding_left=4 \
                                        background.padding_right=4 \
                                        icon.padding_left=6 \
                                        icon.padding_right=4 \
                                        label.padding_left=0 \
                                        label.padding_right=6 \
                                        label.font="SF Pro:Regular:10.0" \
           --add item system_stats_menu.uptime popup.system_stats_menu \
           --set system_stats_menu.uptime background.drawing=on \
                                          background.color=0x30000000 \
                                          background.corner_radius=4 \
                                          background.height=18 \
                                          background.padding_left=4 \
                                          background.padding_right=4 \
                                          icon.padding_left=6 \
                                          icon.padding_right=4 \
                                          label.padding_left=0 \
                                          label.padding_right=6 \
                                          label.font="SF Pro:Regular:10.0" \
           --add item system_stats_menu.load popup.system_stats_menu \
           --set system_stats_menu.load background.drawing=on \
                                        background.color=0x30000000 \
                                        background.corner_radius=4 \
                                        background.height=18 \
                                        background.padding_left=4 \
                                        background.padding_right=4 \
                                        icon.padding_left=6 \
                                        icon.padding_right=4 \
                                        label.padding_left=0 \
                                        label.padding_right=6 \
                                        label.font="SF Pro:Regular:10.0"

##### Adding System Monitoring Items #####
sketchybar --add item cpu right \
           --set cpu update_freq=4 \
                     background.drawing=on \
                     background.color=0x20000000 \
                     background.corner_radius=4 \
                     background.height=18 \
                     background.padding_left=2 \
                     background.padding_right=2 \
                     icon.padding_left=6 \
                     icon.padding_right=2 \
                     label.padding_left=0 \
                     label.padding_right=6 \
                     label.font="SF Pro:Medium:10.0" \
                     script="$PLUGIN_DIR/cpu.sh" \
           --add item network_traffic right \
           --set network_traffic update_freq=2 \
                                 background.drawing=on \
                                 background.color=0x20000000 \
                                 background.corner_radius=4 \
                                 background.height=18 \
                                 background.padding_left=2 \
                                 background.padding_right=2 \
                                 icon.padding_left=6 \
                                 icon.padding_right=2 \
                                 label.padding_left=0 \
                                 label.padding_right=6 \
                                 label.font="SF Pro:Medium:10.0" \
                                 script="$PLUGIN_DIR/network_traffic.sh" \
           --add item network right \
           --set network update_freq=8 \
                         background.drawing=on \
                         background.color=0x20000000 \
                         background.corner_radius=4 \
                         background.height=18 \
                         background.padding_left=2 \
                         background.padding_right=2 \
                         icon.padding_left=6 \
                         icon.padding_right=2 \
                         label.padding_left=0 \
                         label.padding_right=6 \
                         label.font="SF Pro:Medium:10.0" \
                         script="$PLUGIN_DIR/network.sh"

##### Force all scripts to run the first time #####
sketchybar --update

echo "SketchyBar configuration loaded"